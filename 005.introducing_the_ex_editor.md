# Introducing the ex Editor

`vi` is the visual mode of the more general, underlying **line editor**, which is `ex`.

[TOC]

## 1. ex Commands

### 1.1 Basic Operation(open/print/line number)

假如有一个*practice*文件，内容如下：

```txt
烨烨惊雷难入眠，
风挟细雨叩窗栏。
懒起近窗问何事，
相逢总归有前缘。
```

使用`ex Editor`打开*practice*文件：

```
$ ex practice
"practice" 4L, 100C
Entering Ex mode.  Type "visual" to go to Normal mode.
```

`ex` commands consist of **a line address** (which can simply be a line number) plus **a command**; they are finished with a carriage return (by hitting  ENTER). One of the most basic commands is `p` for **print** (to the screen). 

输入`1p`，打印第1行

```
:1p
烨烨惊雷难入眠，
```

In fact, you can leave off the `p`, because a line number by itself is equivalent to a print command for that line.

输入`1,3`，打印1~3行数据

```
:1,3
烨烨惊雷难入眠，
风挟细雨叩窗栏。
懒起近窗问何事，
```

**A command without a line number** is assumed to affect **the current line**.

### 1.2 from ex to vi

The command `:vi` will get you from `ex` to `vi`.

输入`vi`，由`ex Editor`转到`vi Editor`

```
:vi
```

### 1.3 from vi to ex

To invoke an `ex` command from `vi`, you must type the special bottom-line character **`:`** (colon). Then type **the command** and press `ENTER` to execute it.

## 2. Editing with ex

Obviously, you will use `dw` or `dd` to delete **a single word** or **line** rather than using the `delete` command in `ex`. However, when you want to **make changes that affect numerous lines**, you will find the `ex` commands more useful. They allow you to modify large blocks of text with a single command.

> 总结：ex commands适合于对多行文本进行操作。

These `ex` commands are listed here, along with abbreviations for those commands.

| Full name | Abbreviation | Meaning |
|:---------:|:------------:|---------|
| `delete` | `d` | Delete lines |
| `move` | `m` | Move lines |
| `copy` | `co` | Copy lines |
|  | `t` | Copy lines (a synonym for `co`) |


### 2.1 Line Address

You already know how to think of **files** as **a sequence of numbered lines**.

For each `ex` editing command, you have to tell `ex` which line number(s) to edit. And for the `ex move` and `copy` commands, you also need to tell `ex` where to move or copy the text to.

You can specify line addresses in several ways:

- With **explicit line numbers**
- With **symbols** that help you specify line numbers **relative to your current position** in the file
- With **search patterns** as addresses that identify the lines to be affected


### 2.2 Defining a Range of Lines

```
:3,18d         # Delete lines 3 through 18.
:160,224m23    # Move lines 160 through 224 to follow line 23.
:23,29co100    # Copy lines 23 through 29 and put after line 100.
:1,10#         # To temporarily display the line numbers  from line 1 to line 10.
```

如何显示行号：

```
:set number
#或者
:set nu
```

如何隐藏行号：

```
:set nonumber
或者
:set nonu
```

You can also use the `CTRL-G` command to display the current line number.
Yet **another way to identify line numbers** is with the `ex =` command:

```
:=             # Print the total number of lines.
:.=            # Print the line number of the current line.
:/pattern/=    # Print the line number of the first line that matches pattern.
```

### 2.3 Line Addressing Symbols

You can also use **symbols** for **line addresses**. **A dot** (`.`) stands for **the current line**; and `$` stands for **the last line of the file**. `%` stands for **every line in the file**; it’s the same as the combination `1,$`. **These symbols** can also be combined with **absolute line addresses**.

> 注意，在Normal模式下，$表示一行的结尾；而在ex模式下，$表示文件的最后一行。

```
:.,$d         # Delete from current line to end of file.
:20,.m$       # Move from line 20 through the current line to the end of the file.
:%d           # Delete all the lines in a file.
:%t$          # Copy all lines and place them at the end of the file
```

The symbols `+` and `-` work like arithmetic operators.

```
:.,.+20d      # Delete from current line through the next 20 lines.
:226,$m.-2    # Move lines 226 through the end of the file to two lines above the current line.
:.,+20#       # Display line numbers from the current line to 20 lines further on in the file.
```

The number `0` stands for **the top of the file** (imaginary line 0). `0` is equivalent to `1-`, and both allow you to move or copy lines to the very start of a file, before the first line of existing text.

```
:-,+t0     # Copy three lines (the line above the cursor through the line below the cursor) and put them at the top of the file.
```

### 2.4 Search Patterns

Another way that `ex` can address lines is by using **search patterns**.

```
:/pattern/d     # Delete the next line containing pattern.
:/pattern/+d    # Delete the line below the next line containing pattern.
:.,/pattern/m23 # Take the text from the current line (.) through the first line containing pattern and put it after line 23.
```

Note that **a pattern** is delimited by a **slash** both **before** and **after**.

### 2.5 Global Searches

`ex` has a **global command**, `g`, that lets you **search for a pattern** and **display all lines containing the pattern** when it finds them. The command `:g!` does the opposite of `:g`. Use `:g!` (or its synonym, `:v`) to search for all lines that do not contain pattern.

You can use **the global command** on **all lines in the file**, or you can use **line addresses** to limit a global search to specified lines or to a range of lines.

```
:g/pattern     # Finds (moves to) the last occurrence of pattern in the file.
:g/pattern/p   # Finds and displays all lines in the file containing pattern.
:g!/pattern/nu         # Finds and displays all lines in the file that don’t contain pattern; also displays the line number for each line found.
:60,124g/pattern/p     # Finds and displays any lines between lines 60 and 124 containing pattern.
```

As you might expect, `g` can also be used for **global replacements**.

测试文本：

```txt
1、Don't put off till tomorrow what should be done today.  今日事，今日畢。

2、Where there is a will, there is a way. 有志者事竟成。

3、Failure is the mother of success. 失敗是成功之母。

4、Time will tell. 時間會證明一切

5、All roads lead to Rome. 條條大路通羅馬。

6、It is never too old to learn. 活到老，學到老。

7、It is hard to fail, but it is worse never to have tried to succeed.  – Theodore Roosevelt, 
失敗很不好，但從不嘗試取得成功更糟。– 西奧多‧羅斯福
※人稱老羅斯福，美國總統。說明勇敢嘗試，盡一己之力的重要!
```

任务：

- 比较Search Patterns与Global Patterns的区别


